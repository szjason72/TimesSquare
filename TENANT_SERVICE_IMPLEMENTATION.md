# ç§Ÿæˆ·ç®¡ç†æœåŠ¡å®ç°å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ å®æ–½æ¦‚è¿°

**å®Œæˆæ—¶é—´**: 2025-01-XX  
**æœåŠ¡åç§°**: tenant-service  
**ç«¯å£**: 8088  
**çŠ¶æ€**: âœ… **å·²å®Œæˆ**

---

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. æ•°æ®æ¨¡å‹ï¼ˆmodels.goï¼‰

#### Tenant ç§Ÿæˆ·æ¨¡å‹
- âœ… IDã€åç§°ã€ä»£ç ï¼ˆå”¯ä¸€ï¼‰
- âœ… æè¿°ã€çŠ¶æ€ï¼ˆactive/suspended/deletedï¼‰
- âœ… é…ç½®ä¿¡æ¯ï¼ˆJSONæ ¼å¼ï¼‰
- âœ… é…é¢ä¿¡æ¯ï¼ˆJSONæ ¼å¼ï¼‰
- âœ… æ—¶é—´æˆ³å­—æ®µ

#### UserTenant ç”¨æˆ·-ç§Ÿæˆ·å…³è”æ¨¡å‹
- âœ… ç”¨æˆ·IDã€ç§Ÿæˆ·ID
- âœ… è§’è‰²ï¼ˆowner/admin/member/guestï¼‰
- âœ… çŠ¶æ€ï¼ˆactive/inactiveï¼‰
- âœ… åŠ å…¥æ—¶é—´

#### TenantSettings ç§Ÿæˆ·é…ç½®
- âœ… ä¸»é¢˜ã€è¯­è¨€ã€æ—¶åŒº
- âœ… è‡ªå®šä¹‰é…ç½®ï¼ˆJSONï¼‰

#### TenantQuota ç§Ÿæˆ·é…é¢
- âœ… æœ€å¤§ç”¨æˆ·æ•°
- âœ… æœ€å¤§å­˜å‚¨ç©ºé—´
- âœ… æœ€å¤§APIè°ƒç”¨æ¬¡æ•°
- âœ… æœ€å¤§AIè°ƒç”¨æ¬¡æ•°
- âœ… è‡ªå®šä¹‰é…é¢

---

### 2. æœåŠ¡å±‚ï¼ˆservice.goï¼‰

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… **CreateTenant**: åˆ›å»ºç§Ÿæˆ·ï¼ˆè‡ªåŠ¨å°†åˆ›å»ºè€…è®¾ä¸ºownerï¼‰
- âœ… **GetTenant**: è·å–ç§Ÿæˆ·è¯¦æƒ…
- âœ… **GetTenantByCode**: æ ¹æ®codeè·å–ç§Ÿæˆ·
- âœ… **ListTenants**: è·å–ç§Ÿæˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µã€çŠ¶æ€è¿‡æ»¤ï¼‰
- âœ… **UpdateTenant**: æ›´æ–°ç§Ÿæˆ·ä¿¡æ¯
- âœ… **DeleteTenant**: åˆ é™¤ç§Ÿæˆ·ï¼ˆè½¯åˆ é™¤ï¼‰

#### ç”¨æˆ·-ç§Ÿæˆ·ç®¡ç†
- âœ… **AddUserToTenant**: æ·»åŠ ç”¨æˆ·åˆ°ç§Ÿæˆ·
- âœ… **RemoveUserFromTenant**: ä»ç§Ÿæˆ·ç§»é™¤ç”¨æˆ·
- âœ… **GetUserTenants**: è·å–ç”¨æˆ·æ‰€å±çš„ç§Ÿæˆ·åˆ—è¡¨
- âœ… **GetTenantUsers**: è·å–ç§Ÿæˆ·çš„ç”¨æˆ·åˆ—è¡¨
- âœ… **CheckUserTenantPermission**: æ£€æŸ¥ç”¨æˆ·åœ¨ç§Ÿæˆ·ä¸­çš„æƒé™

#### ç§Ÿæˆ·åˆ‡æ¢
- âœ… **SwitchTenant**: åˆ‡æ¢ç§Ÿæˆ·ï¼ˆæ›´æ–°ç”¨æˆ·çš„last_tenant_idï¼‰

---

### 3. APIå±‚ï¼ˆapi.goï¼‰

#### ç§Ÿæˆ·ç®¡ç†API
- âœ… `POST /api/v1/tenants` - åˆ›å»ºç§Ÿæˆ·
- âœ… `GET /api/v1/tenants` - è·å–ç§Ÿæˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€çŠ¶æ€è¿‡æ»¤ï¼‰
- âœ… `GET /api/v1/tenants/:id` - è·å–ç§Ÿæˆ·è¯¦æƒ…
- âœ… `PUT /api/v1/tenants/:id` - æ›´æ–°ç§Ÿæˆ·
- âœ… `DELETE /api/v1/tenants/:id` - åˆ é™¤ç§Ÿæˆ·

#### ç§Ÿæˆ·åˆ‡æ¢API
- âœ… `POST /api/v1/tenants/:id/switch` - åˆ‡æ¢ç§Ÿæˆ·

#### ç”¨æˆ·ç§Ÿæˆ·ç®¡ç†API
- âœ… `GET /api/v1/tenants/my/list` - è·å–å½“å‰ç”¨æˆ·çš„ç§Ÿæˆ·åˆ—è¡¨
- âœ… `GET /api/v1/tenants/:id/users` - è·å–ç§Ÿæˆ·çš„ç”¨æˆ·åˆ—è¡¨
- âœ… `POST /api/v1/tenants/:id/users` - æ·»åŠ ç”¨æˆ·åˆ°ç§Ÿæˆ·
- âœ… `DELETE /api/v1/tenants/:id/users/:user_id` - ä»ç§Ÿæˆ·ç§»é™¤ç”¨æˆ·

#### æƒé™æ§åˆ¶
- âœ… ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç§Ÿæˆ·
- âœ… æ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±æ‰€å±çš„ç§Ÿæˆ·
- âœ… åªæœ‰ç§Ÿæˆ·æ‰€æœ‰è€…å¯ä»¥æ›´æ–°/åˆ é™¤ç§Ÿæˆ·
- âœ… åªæœ‰ç§Ÿæˆ·æ‰€æœ‰è€…/ç®¡ç†å‘˜å¯ä»¥æ·»åŠ /ç§»é™¤ç”¨æˆ·

---

### 4. ä¸»ç¨‹åºï¼ˆmain.goï¼‰

#### æœåŠ¡å¯åŠ¨
- âœ… åˆå§‹åŒ–JobFirstæ ¸å¿ƒåŒ…
- âœ… è·å–æ•°æ®åº“è¿æ¥
- âœ… åˆ›å»ºç§Ÿæˆ·æœåŠ¡å®ä¾‹
- âœ… è®¾ç½®Ginè·¯ç”±
- âœ… é›†æˆè®¤è¯ä¸­é—´ä»¶
- âœ… é›†æˆç§Ÿæˆ·ä¸­é—´ä»¶
- âœ… æ³¨å†Œåˆ°Consul

#### æ ‡å‡†è·¯ç”±
- âœ… `GET /health` - å¥åº·æ£€æŸ¥
- âœ… `GET /version` - ç‰ˆæœ¬ä¿¡æ¯
- âœ… `GET /info` - æœåŠ¡ä¿¡æ¯

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
services/core/tenant/
â”œâ”€â”€ models.go      # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ service.go     # ä¸šåŠ¡é€»è¾‘å±‚
â”œâ”€â”€ api.go         # APIå¤„ç†å™¨
â”œâ”€â”€ main.go        # æœåŠ¡å…¥å£
â””â”€â”€ go.mod         # Goæ¨¡å—å®šä¹‰
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ•°æ®åº“
- âœ… PostgreSQLï¼ˆä½¿ç”¨GORMï¼‰
- âœ… è¡¨ï¼š`zervigo_tenants`ã€`zervigo_user_tenants`
- âœ… JSONBå­—æ®µï¼š`settings`ã€`quota`

### è®¤è¯é›†æˆ
- âœ… é›†æˆauth-serviceè¿›è¡ŒJWTéªŒè¯
- âœ… ä»JWT Tokenè·å–ç”¨æˆ·ä¿¡æ¯
- âœ… æ”¯æŒç§Ÿæˆ·IDä»JWTæˆ–è¯·æ±‚å¤´è·å–

### æƒé™æ§åˆ¶
- âœ… åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
- âœ… ç§Ÿæˆ·çº§åˆ«çš„æƒé™éªŒè¯
- âœ… ç®¡ç†å‘˜æƒé™æ£€æŸ¥

---

## ğŸ¯ APIä½¿ç”¨ç¤ºä¾‹

### 1. åˆ›å»ºç§Ÿæˆ·

```bash
POST /api/v1/tenants
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "æˆ‘çš„å…¬å¸",
  "code": "mycompany",
  "description": "å…¬å¸ç§Ÿæˆ·",
  "settings": {
    "theme": "light",
    "language": "zh-CN"
  },
  "quota": {
    "max_users": 100,
    "max_storage": 10240
  }
}
```

### 2. è·å–ç§Ÿæˆ·åˆ—è¡¨

```bash
GET /api/v1/tenants?page=1&page_size=20&status=active
Authorization: Bearer <token>
```

### 3. åˆ‡æ¢ç§Ÿæˆ·

```bash
POST /api/v1/tenants/1/switch
Authorization: Bearer <token>
```

### 4. è·å–æˆ‘çš„ç§Ÿæˆ·åˆ—è¡¨

```bash
GET /api/v1/tenants/my/list
Authorization: Bearer <token>
```

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### zervigo_tenants
- `id` BIGSERIAL PRIMARY KEY
- `name` VARCHAR(100) NOT NULL
- `code` VARCHAR(50) UNIQUE NOT NULL
- `description` TEXT
- `status` VARCHAR(20) DEFAULT 'active'
- `settings` JSONB DEFAULT '{}'
- `quota` JSONB DEFAULT '{}'
- `created_at` TIMESTAMP
- `updated_at` TIMESTAMP
- `deleted_at` TIMESTAMP

### zervigo_user_tenants
- `id` BIGSERIAL PRIMARY KEY
- `user_id` BIGINT NOT NULL
- `tenant_id` BIGINT NOT NULL
- `role` VARCHAR(50) DEFAULT 'member'
- `status` VARCHAR(20) DEFAULT 'active'
- `joined_at` TIMESTAMP
- `created_at` TIMESTAMP
- `updated_at` TIMESTAMP

---

## ğŸš€ å¯åŠ¨æœåŠ¡

### ç¯å¢ƒå˜é‡
```bash
export DATABASE_URL="postgres://user:password@localhost:5432/zervigo_mvp?sslmode=disable"
export AUTH_SERVICE_URL="http://localhost:8207"
export TENANT_SERVICE_PORT="8088"
```

### å¯åŠ¨å‘½ä»¤
```bash
cd /Users/szjason72/gozervi/zervigo.demo/services/core/tenant
go run main.go
```

---

## âœ… æµ‹è¯•å»ºè®®

### 1. åŠŸèƒ½æµ‹è¯•
- [ ] åˆ›å»ºç§Ÿæˆ·
- [ ] è·å–ç§Ÿæˆ·åˆ—è¡¨
- [ ] æ›´æ–°ç§Ÿæˆ·ä¿¡æ¯
- [ ] åˆ é™¤ç§Ÿæˆ·
- [ ] åˆ‡æ¢ç§Ÿæˆ·
- [ ] æ·»åŠ ç”¨æˆ·åˆ°ç§Ÿæˆ·
- [ ] ä»ç§Ÿæˆ·ç§»é™¤ç”¨æˆ·

### 2. æƒé™æµ‹è¯•
- [ ] ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç§Ÿæˆ·
- [ ] æ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ç§Ÿæˆ·
- [ ] åªæœ‰æ‰€æœ‰è€…å¯ä»¥æ›´æ–°/åˆ é™¤ç§Ÿæˆ·
- [ ] åªæœ‰æ‰€æœ‰è€…/ç®¡ç†å‘˜å¯ä»¥ç®¡ç†ç”¨æˆ·

### 3. æ•°æ®éš”ç¦»æµ‹è¯•
- [ ] ç§Ÿæˆ·Açš„ç”¨æˆ·æ— æ³•è®¿é—®ç§Ÿæˆ·Bçš„æ•°æ®
- [ ] åˆ‡æ¢ç§Ÿæˆ·åï¼Œæ•°æ®æŸ¥è¯¢æ­£ç¡®éš”ç¦»

---

## ğŸ“ åç»­å·¥ä½œ

### é«˜ä¼˜å…ˆçº§
- [ ] å‰ç«¯å®ç°ç§Ÿæˆ·ç®¡ç†é¡µé¢
- [ ] å‰ç«¯å®ç°ç§Ÿæˆ·åˆ‡æ¢ç»„ä»¶
- [ ] é›†æˆæµ‹è¯•
- [ ] APIæ–‡æ¡£ï¼ˆSwaggerï¼‰

### ä¸­ä¼˜å…ˆçº§
- [ ] ç§Ÿæˆ·é…é¢æ£€æŸ¥
- [ ] ç§Ÿæˆ·æ•°æ®ç»Ÿè®¡
- [ ] ç§Ÿæˆ·æ“ä½œå®¡è®¡æ—¥å¿—

### ä½ä¼˜å…ˆçº§
- [ ] ç§Ÿæˆ·æ•°æ®å¯¼å‡º
- [ ] ç§Ÿæˆ·æ•°æ®æ¸…ç†
- [ ] ç§Ÿæˆ·æ€§èƒ½ç›‘æ§

---

## ğŸ‰ æ€»ç»“

ç§Ÿæˆ·ç®¡ç†æœåŠ¡å·²ç»å®Œæˆæ ¸å¿ƒåŠŸèƒ½çš„å®ç°ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… **å®Œæ•´çš„æ•°æ®æ¨¡å‹**ï¼šç§Ÿæˆ·ã€ç”¨æˆ·-ç§Ÿæˆ·å…³è”
2. âœ… **å®Œæ•´çš„æœåŠ¡å±‚**ï¼šCRUDã€ç”¨æˆ·ç®¡ç†ã€ç§Ÿæˆ·åˆ‡æ¢
3. âœ… **å®Œæ•´çš„APIå±‚**ï¼šRESTful APIã€æƒé™æ§åˆ¶
4. âœ… **æœåŠ¡é›†æˆ**ï¼šè®¤è¯ã€Consulæ³¨å†Œ

**ä¸‹ä¸€æ­¥**ï¼šå®ç°å‰ç«¯é¡µé¢å’Œç»„ä»¶ï¼Œå®Œæˆç§Ÿæˆ·ç®¡ç†çš„å®Œæ•´åŠŸèƒ½ã€‚

---

**å®æ–½å®Œæˆæ—¶é—´**: 2025-01-XX  
**æœåŠ¡çŠ¶æ€**: âœ… **å·²å®Œæˆ**  
**ä¸‹ä¸€æ­¥**: å‰ç«¯å®ç°

