# GoZerviæ™ºèƒ½åŒ–SaaSç³»ç»Ÿå®æ–½æ–¹æ¡ˆ

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**: GoZerviæ™ºèƒ½åŒ–SaaSæœåŠ¡ç³»ç»Ÿ  
**å½“å‰çŠ¶æ€**: 88%å®Œæˆï¼ˆç¼ºå°‘å¤šç§Ÿæˆ·æ”¯æŒï¼‰  
**ç›®æ ‡**: 100%å®Œæ•´çš„æ™ºèƒ½åŒ–SaaSç³»ç»Ÿ  
**å‚è€ƒé¡¹ç›®**: CordysCRMï¼ˆå®Œæ•´å¤šç§Ÿæˆ·å®ç°ï¼‰  
**é¢„è®¡å·¥æœŸ**: 4-6å‘¨

---

## ğŸ¯ å®æ–½ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡
1. âœ… **è¡¥å……å¤šç§Ÿæˆ·æ”¯æŒ**ï¼ˆæ ¸å¿ƒç¼ºå¤±åŠŸèƒ½ï¼‰
2. âœ… **å®Œå–„ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½**
3. âœ… **å®ç°æ•°æ®éš”ç¦»æœºåˆ¶**
4. âœ… **ä¼˜åŒ–æƒé™éš”ç¦»ä½“ç³»**
5. âœ… **å®Œå–„ç›‘æ§å’Œæ–‡æ¡£**

### æˆåŠŸæ ‡å‡†
- âœ… æ‰€æœ‰ä¸šåŠ¡è¡¨åŒ…å« `tenant_id` å­—æ®µ
- âœ… æ‰€æœ‰æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤ç§Ÿæˆ·æ•°æ®
- âœ… æ”¯æŒç§Ÿæˆ·åˆ›å»ºã€åˆ‡æ¢ã€ç®¡ç†
- âœ… ç§Ÿæˆ·çº§åˆ«çš„æƒé™éš”ç¦»
- âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–

---

## ğŸ“‹ ç°çŠ¶åˆ†æ

### å·²å…·å¤‡çš„åŠŸèƒ½ âœ…

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | å®Œæˆåº¦ |
|---------|------|--------|
| å¾®æœåŠ¡æ¶æ„ | âœ… å®Œæ•´ | 100% |
| API Gateway | âœ… å®Œæ•´ | 100% |
| è®¤è¯æˆæƒ | âœ… å®Œæ•´ | 100% |
| RBACæƒé™æ¨¡å‹ | âœ… å®Œæ•´ | 100% |
| å‰ç«¯ç®¡ç†åå° | âœ… å®Œæ•´ | 100% |
| åŸºç¡€è®¾æ–½ | âœ… å®Œæ•´ | 100% |
| AIæœåŠ¡ | âœ… å®Œæ•´ | 100% |

### ç¼ºå¤±çš„åŠŸèƒ½ âŒ

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|---------|------|--------|
| å¤šç§Ÿæˆ·æ”¯æŒ | âŒ ç¼ºå¤± | ğŸ”´ P0 |
| ç§Ÿæˆ·ç®¡ç† | âŒ ç¼ºå¤± | ğŸ”´ P0 |
| æ•°æ®éš”ç¦» | âŒ ç¼ºå¤± | ğŸ”´ P0 |
| ç§Ÿæˆ·æƒé™éš”ç¦» | âš ï¸ éƒ¨åˆ† | ğŸŸ¡ P1 |
| ç›‘æ§ç³»ç»Ÿ | âš ï¸ éƒ¨åˆ† | ğŸŸ¢ P2 |
| APIæ–‡æ¡£ | âš ï¸ éƒ¨åˆ† | ğŸŸ¢ P2 |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### å¤šç§Ÿæˆ·æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯å±‚ (Vue 3)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Web App â”‚  â”‚  Admin   â”‚  â”‚  Mobile  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                    â”‚ ç§Ÿæˆ·åˆ‡æ¢                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API Gateway (Go)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  è·¯ç”±è½¬å‘   â”‚  â”‚  é™æµç†”æ–­   â”‚  â”‚  è®¤è¯é‰´æƒ   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                    â”‚ TenantMiddleware                   â”‚
â”‚                    â”‚ (ä»JWTè·å–tenant_id)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æœåŠ¡     â”‚  â”‚  ä¸šåŠ¡æœåŠ¡     â”‚  â”‚  AIæœåŠ¡      â”‚
â”‚  (Go)        â”‚  â”‚  (Python)     â”‚  â”‚  (Python)    â”‚
â”‚              â”‚  â”‚               â”‚  â”‚              â”‚
â”‚ TenantContextâ”‚  â”‚ TenantContext â”‚  â”‚ TenantContextâ”‚
â”‚ è‡ªåŠ¨è¿‡æ»¤     â”‚  â”‚ è‡ªåŠ¨è¿‡æ»¤     â”‚  â”‚ è‡ªåŠ¨è¿‡æ»¤     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æœåŠ¡å‘ç°ä¸é…ç½® (Consul)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL   â”‚  â”‚    Redis     â”‚  â”‚   å…¶ä»–å­˜å‚¨   â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ tenant_id    â”‚  â”‚ tenant_cache â”‚  â”‚              â”‚
â”‚ æ•°æ®éš”ç¦»     â”‚  â”‚ ç§Ÿæˆ·ç¼“å­˜     â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“… åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šå¤šç§Ÿæˆ·æ ¸å¿ƒåŠŸèƒ½ï¼ˆWeek 1-2ï¼‰ğŸ”´ P0

#### Week 1: åŸºç¡€è®¾æ–½æ­å»º

**Day 1-2: ç§Ÿæˆ·ä¸Šä¸‹æ–‡å®ç°**
- [ ] å®ç° `TenantContext`ï¼ˆGoç‰ˆæœ¬ï¼‰
- [ ] å®ç° `TenantMiddleware`ï¼ˆGinä¸­é—´ä»¶ï¼‰
- [ ] å®ç°ç§Ÿæˆ·IDä»JWT Tokenæå–
- [ ] å•å…ƒæµ‹è¯•

**Day 3-4: æ•°æ®åº“è¿ç§»**
- [ ] åˆ›å»ºç§Ÿæˆ·è¡¨ï¼ˆtenantsï¼‰
- [ ] ä¸ºæ‰€æœ‰ä¸šåŠ¡è¡¨æ·»åŠ  `tenant_id` å­—æ®µ
- [ ] åˆ›å»ºç§Ÿæˆ·ç›¸å…³ç´¢å¼•
- [ ] æ•°æ®è¿ç§»è„šæœ¬ï¼ˆç°æœ‰æ•°æ®åˆ†é…é»˜è®¤ç§Ÿæˆ·ï¼‰

**Day 5: åŸºç¡€æ¨¡å‹æ›´æ–°**
- [ ] æ›´æ–°BaseModelåŒ…å«tenant_id
- [ ] å®ç°GORM Scopeè‡ªåŠ¨è¿‡æ»¤
- [ ] æ›´æ–°æ‰€æœ‰é¢†åŸŸæ¨¡å‹

#### Week 2: ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½

**Day 1-2: ç§Ÿæˆ·ç®¡ç†API**
- [ ] ç§Ÿæˆ·åˆ›å»ºAPI
- [ ] ç§Ÿæˆ·åˆ—è¡¨API
- [ ] ç§Ÿæˆ·è¯¦æƒ…API
- [ ] ç§Ÿæˆ·æ›´æ–°API
- [ ] ç§Ÿæˆ·åˆ é™¤APIï¼ˆè½¯åˆ é™¤ï¼‰

**Day 3-4: ç”¨æˆ·-ç§Ÿæˆ·å…³è”**
- [ ] ç”¨æˆ·-ç§Ÿæˆ·å…³è”è¡¨
- [ ] ç”¨æˆ·åŠ å…¥ç§Ÿæˆ·API
- [ ] ç”¨æˆ·ç¦»å¼€ç§Ÿæˆ·API
- [ ] ç”¨æˆ·ç§Ÿæˆ·åˆ—è¡¨API

**Day 5: ç§Ÿæˆ·åˆ‡æ¢åŠŸèƒ½**
- [ ] ç§Ÿæˆ·åˆ‡æ¢API
- [ ] JWT TokenåŒ…å«ç§Ÿæˆ·ID
- [ ] å‰ç«¯ç§Ÿæˆ·åˆ‡æ¢ç»„ä»¶

---

### ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®éš”ç¦»å®Œå–„ï¼ˆWeek 3ï¼‰ğŸŸ¡ P1

**Day 1-2: Serviceå±‚æ›´æ–°**
- [ ] æ›´æ–°æ‰€æœ‰Serviceæ–¹æ³•æ¥æ”¶tenantID
- [ ] å®ç°æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤
- [ ] å®ç°åˆ›å»ºè‡ªåŠ¨è®¾ç½®tenant_id
- [ ] å®ç°æ›´æ–°è‡ªåŠ¨æ ¡éªŒtenant_id

**Day 3-4: Mapper/DAOå±‚æ›´æ–°**
- [ ] æ›´æ–°æ‰€æœ‰æŸ¥è¯¢SQLæ·»åŠ tenant_idè¿‡æ»¤
- [ ] æ›´æ–°æ‰€æœ‰æ’å…¥SQLæ·»åŠ tenant_id
- [ ] æ›´æ–°æ‰€æœ‰æ›´æ–°SQLæ·»åŠ tenant_idæ ¡éªŒ

**Day 5: æµ‹è¯•éªŒè¯**
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ•°æ®éš”ç¦»æµ‹è¯•

---

### ç¬¬ä¸‰é˜¶æ®µï¼šæƒé™éš”ç¦»å®Œå–„ï¼ˆWeek 4ï¼‰ğŸŸ¡ P1

**Day 1-2: ç§Ÿæˆ·çº§åˆ«æƒé™**
- [ ] è§’è‰²è¡¨æ·»åŠ tenant_id
- [ ] æƒé™è¡¨æ·»åŠ tenant_id
- [ ] ç”¨æˆ·è§’è‰²å…³è”è¡¨æ·»åŠ tenant_id

**Day 3-4: æƒé™æ£€æŸ¥æ›´æ–°**
- [ ] æƒé™æ£€æŸ¥æ—¶è¿‡æ»¤tenant_id
- [ ] è§’è‰²æŸ¥è¯¢æ—¶è¿‡æ»¤tenant_id
- [ ] æƒé™åˆ†é…æ—¶æ ¡éªŒtenant_id

**Day 5: æµ‹è¯•éªŒè¯**
- [ ] æƒé™éš”ç¦»æµ‹è¯•
- [ ] è·¨ç§Ÿæˆ·è®¿é—®æµ‹è¯•

---

### ç¬¬å››é˜¶æ®µï¼šå‰ç«¯é›†æˆï¼ˆWeek 5ï¼‰ğŸŸ¡ P1

**Day 1-2: ç§Ÿæˆ·ç®¡ç†é¡µé¢**
- [ ] ç§Ÿæˆ·åˆ—è¡¨é¡µé¢
- [ ] ç§Ÿæˆ·åˆ›å»º/ç¼–è¾‘é¡µé¢
- [ ] ç§Ÿæˆ·è¯¦æƒ…é¡µé¢

**Day 3-4: ç§Ÿæˆ·åˆ‡æ¢åŠŸèƒ½**
- [ ] ç§Ÿæˆ·åˆ‡æ¢ä¸‹æ‹‰èœå•
- [ ] ç§Ÿæˆ·åˆ‡æ¢APIè°ƒç”¨
- [ ] ç§Ÿæˆ·åˆ‡æ¢ååˆ·æ–°æ•°æ®

**Day 5: æµ‹è¯•éªŒè¯**
- [ ] å‰ç«¯åŠŸèƒ½æµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•

---

### ç¬¬äº”é˜¶æ®µï¼šä¼˜åŒ–ä¸å®Œå–„ï¼ˆWeek 6ï¼‰ğŸŸ¢ P2

**Day 1-2: ç›‘æ§ç³»ç»Ÿ**
- [ ] PrometheusæŒ‡æ ‡æ”¶é›†
- [ ] Grafanaå¯è§†åŒ–é¢æ¿
- [ ] ç§Ÿæˆ·çº§åˆ«ç›‘æ§

**Day 3-4: APIæ–‡æ¡£**
- [ ] Swaggeré›†æˆ
- [ ] APIæ–‡æ¡£ç”Ÿæˆ
- [ ] Postman Collection

**Day 5: æ€§èƒ½ä¼˜åŒ–**
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- [ ] ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- [ ] ç´¢å¼•ä¼˜åŒ–

---

## ğŸ’» è¯¦ç»†å®æ–½æ­¥éª¤

### Step 1: ç§Ÿæˆ·ä¸Šä¸‹æ–‡å®ç°

#### 1.1 åˆ›å»ºTenantContext

**æ–‡ä»¶**: `shared/core/context/tenant_context.go`

```go
package context

import (
    "context"
    "errors"
)

type tenantIDKey struct{}

var (
    ErrNoTenantPermission = errors.New("no tenant permission")
    ErrTenantNotFound     = errors.New("tenant not found")
)

// GetTenantID ä»contextè·å–ç§Ÿæˆ·ID
func GetTenantID(ctx context.Context) (int64, error) {
    tenantID, ok := ctx.Value(tenantIDKey{}).(int64)
    if !ok || tenantID == 0 {
        return 0, ErrTenantNotFound
    }
    return tenantID, nil
}

// SetTenantID è®¾ç½®ç§Ÿæˆ·IDåˆ°context
func SetTenantID(ctx context.Context, tenantID int64) context.Context {
    return context.WithValue(ctx, tenantIDKey{}, tenantID)
}

// MustGetTenantID è·å–ç§Ÿæˆ·IDï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™panicï¼‰
func MustGetTenantID(ctx context.Context) int64 {
    tenantID, err := GetTenantID(ctx)
    if err != nil {
        panic(err)
    }
    return tenantID
}
```

#### 1.2 åˆ›å»ºTenantMiddleware

**æ–‡ä»¶**: `shared/core/middleware/tenant_middleware.go`

```go
package middleware

import (
    "github.com/gin-gonic/gin"
    "github.com/szjason72/zervigo/shared/core/context"
    "github.com/szjason72/zervigo/shared/core/auth"
)

// TenantMiddleware ç§Ÿæˆ·IDä¸­é—´ä»¶
func TenantMiddleware() gin.HandlerFunc {
    return func(c *gin.Context) {
        // 1. å°è¯•ä»JWT Tokenè·å–ç§Ÿæˆ·ID
        user := auth.GetUserFromContext(c)
        if user != nil && user.TenantID > 0 {
            ctx := context.SetTenantID(c.Request.Context(), user.TenantID)
            c.Request = c.Request.WithContext(ctx)
            c.Set("tenant_id", user.TenantID)
            c.Next()
            return
        }
        
        // 2. å°è¯•ä»è¯·æ±‚å¤´è·å–ç§Ÿæˆ·IDï¼ˆç”¨äºåˆ‡æ¢ç§Ÿæˆ·ï¼‰
        tenantIDHeader := c.GetHeader("X-Tenant-ID")
        if tenantIDHeader != "" {
            // è§£æå¹¶éªŒè¯ç§Ÿæˆ·ID
            // TODO: éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰è¯¥ç§Ÿæˆ·çš„æƒé™
            // tenantID := parseTenantID(tenantIDHeader)
            // ctx := context.SetTenantID(c.Request.Context(), tenantID)
            // c.Request = c.Request.WithContext(ctx)
        }
        
        c.Next()
    }
}
```

---

### Step 2: æ•°æ®åº“è¿ç§»

#### 2.1 åˆ›å»ºç§Ÿæˆ·è¡¨

**æ–‡ä»¶**: `databases/postgres/init/03-tenant-tables.sql`

```sql
-- ç§Ÿæˆ·è¡¨
CREATE TABLE IF NOT EXISTS zervigo_tenants (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL COMMENT 'ç§Ÿæˆ·åç§°',
    code VARCHAR(50) UNIQUE NOT NULL COMMENT 'ç§Ÿæˆ·ä»£ç ',
    description TEXT COMMENT 'ç§Ÿæˆ·æè¿°',
    
    -- çŠ¶æ€ä¿¡æ¯
    status VARCHAR(20) DEFAULT 'active' COMMENT 'çŠ¶æ€: active, suspended, deleted',
    
    -- é…ç½®ä¿¡æ¯
    settings JSONB DEFAULT '{}' COMMENT 'ç§Ÿæˆ·é…ç½®',
    
    -- é…é¢ä¿¡æ¯
    quota JSONB DEFAULT '{}' COMMENT 'èµ„æºé…é¢',
    
    -- æ—¶é—´æˆ³
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP,
    
    INDEX idx_code (code),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
);

-- ç”¨æˆ·-ç§Ÿæˆ·å…³è”è¡¨
CREATE TABLE IF NOT EXISTS zervigo_user_tenants (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES zervigo_auth_users(id) ON DELETE CASCADE,
    tenant_id BIGINT NOT NULL REFERENCES zervigo_tenants(id) ON DELETE CASCADE,
    
    -- è§’è‰²ä¿¡æ¯
    role VARCHAR(50) DEFAULT 'member' COMMENT 'è§’è‰²: owner, admin, member',
    
    -- çŠ¶æ€ä¿¡æ¯
    status VARCHAR(20) DEFAULT 'active' COMMENT 'çŠ¶æ€: active, inactive',
    
    -- æ—¶é—´æˆ³
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(user_id, tenant_id),
    INDEX idx_user_id (user_id),
    INDEX idx_tenant_id (tenant_id),
    INDEX idx_role (role)
);
```

#### 2.2 ä¸ºç°æœ‰è¡¨æ·»åŠ tenant_id

**æ–‡ä»¶**: `databases/postgres/migrations/add_tenant_id.sql`

```sql
-- ä¸ºæ‰€æœ‰ä¸šåŠ¡è¡¨æ·»åŠ tenant_idå­—æ®µ
ALTER TABLE zervigo_jobs ADD COLUMN tenant_id BIGINT;
ALTER TABLE zervigo_user_profiles ADD COLUMN tenant_id BIGINT;
ALTER TABLE zervigo_companies ADD COLUMN tenant_id BIGINT;
ALTER TABLE zervigo_resumes ADD COLUMN tenant_id BIGINT;

-- è®¾ç½®é»˜è®¤å€¼ï¼ˆç°æœ‰æ•°æ®åˆ†é…é»˜è®¤ç§Ÿæˆ·ID=1ï¼‰
UPDATE zervigo_jobs SET tenant_id = 1 WHERE tenant_id IS NULL;
UPDATE zervigo_user_profiles SET tenant_id = 1 WHERE tenant_id IS NULL;
UPDATE zervigo_companies SET tenant_id = 1 WHERE tenant_id IS NULL;
UPDATE zervigo_resumes SET tenant_id = 1 WHERE tenant_id IS NULL;

-- è®¾ç½®ä¸ºNOT NULL
ALTER TABLE zervigo_jobs ALTER COLUMN tenant_id SET NOT NULL;
ALTER TABLE zervigo_user_profiles ALTER COLUMN tenant_id SET NOT NULL;
ALTER TABLE zervigo_companies ALTER COLUMN tenant_id SET NOT NULL;
ALTER TABLE zervigo_resumes ALTER COLUMN tenant_id SET NOT NULL;

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_jobs_tenant_id ON zervigo_jobs(tenant_id);
CREATE INDEX idx_user_profiles_tenant_id ON zervigo_user_profiles(tenant_id);
CREATE INDEX idx_companies_tenant_id ON zervigo_companies(tenant_id);
CREATE INDEX idx_resumes_tenant_id ON zervigo_resumes(tenant_id);

-- åˆ›å»ºè”åˆç´¢å¼•
CREATE INDEX idx_jobs_tenant_created ON zervigo_jobs(tenant_id, created_at);
CREATE INDEX idx_jobs_tenant_user ON zervigo_jobs(tenant_id, created_by);
```

---

### Step 3: åŸºç¡€æ¨¡å‹æ›´æ–°

#### 3.1 æ›´æ–°BaseModel

**æ–‡ä»¶**: `shared/core/model/base_model.go`

```go
package model

import (
    "time"
    "gorm.io/gorm"
)

// BaseModel åŸºç¡€æ¨¡å‹ï¼ˆåŒ…å«ç§Ÿæˆ·IDï¼‰
type BaseModel struct {
    ID        int64          `gorm:"primaryKey;autoIncrement" json:"id"`
    TenantID  int64          `gorm:"column:tenant_id;index;not null" json:"tenant_id"`
    CreatedAt time.Time      `gorm:"column:created_at" json:"created_at"`
    UpdatedAt time.Time      `gorm:"column:updated_at" json:"updated_at"`
    DeletedAt gorm.DeletedAt `gorm:"column:deleted_at;index" json:"deleted_at"`
}

// BeforeCreate GORM Hook: åˆ›å»ºå‰è‡ªåŠ¨è®¾ç½®tenant_id
func (m *BaseModel) BeforeCreate(tx *gorm.DB) error {
    if m.TenantID == 0 {
        // ä»contextè·å–tenant_id
        if tenantID, ok := tx.Statement.Context.Value("tenant_id").(int64); ok {
            m.TenantID = tenantID
        }
    }
    return nil
}

// ScopeTenant GORM Scope: è‡ªåŠ¨è¿‡æ»¤ç§Ÿæˆ·
func ScopeTenant(tenantID int64) func(db *gorm.DB) *gorm.DB {
    return func(db *gorm.DB) *gorm.DB {
        return db.Where("tenant_id = ?", tenantID)
    }
}
```

#### 3.2 æ›´æ–°é¢†åŸŸæ¨¡å‹

**æ–‡ä»¶**: `services/business/job/models.go`

```go
package job

import (
    "github.com/szjason72/zervigo/shared/core/model"
)

// Job èŒä½æ¨¡å‹
type Job struct {
    model.BaseModel  // ç»§æ‰¿BaseModelï¼ˆåŒ…å«tenant_idï¼‰
    
    Title       string `gorm:"column:title" json:"title"`
    Description string `gorm:"column:description" json:"description"`
    CompanyID   int64  `gorm:"column:company_id" json:"company_id"`
    // ... å…¶ä»–å­—æ®µ
}
```

---

### Step 4: Serviceå±‚æ›´æ–°

#### 4.1 æ›´æ–°JobService

**æ–‡ä»¶**: `services/business/job/service.go`

```go
package job

import (
    "context"
    "github.com/szjason72/zervigo/shared/core/context"
    "github.com/szjason72/zervigo/shared/core/model"
    "gorm.io/gorm"
)

type JobService struct {
    db *gorm.DB
}

// List åˆ—è¡¨æŸ¥è¯¢ï¼ˆè‡ªåŠ¨è¿‡æ»¤ç§Ÿæˆ·ï¼‰
func (s *JobService) List(ctx context.Context, req *JobListRequest) ([]*Job, error) {
    // 1. ä»contextè·å–ç§Ÿæˆ·ID
    tenantID, err := context.GetTenantID(ctx)
    if err != nil {
        return nil, err
    }
    
    // 2. æŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤ç§Ÿæˆ·
    var jobs []*Job
    query := s.db.Model(&Job{}).
        Where("tenant_id = ?", tenantID)  // è‡ªåŠ¨è¿‡æ»¤ç§Ÿæˆ·
    
    if req.Keyword != "" {
        query = query.Where("title LIKE ?", "%"+req.Keyword+"%")
    }
    
    err = query.Find(&jobs).Error
    return jobs, err
}

// Create åˆ›å»ºï¼ˆè‡ªåŠ¨è®¾ç½®tenant_idï¼‰
func (s *JobService) Create(ctx context.Context, req *JobCreateRequest) (*Job, error) {
    // 1. ä»contextè·å–ç§Ÿæˆ·ID
    tenantID, err := context.GetTenantID(ctx)
    if err != nil {
        return nil, err
    }
    
    // 2. åˆ›å»ºæ—¶è‡ªåŠ¨è®¾ç½®tenant_id
    job := &Job{
        BaseModel: model.BaseModel{
            TenantID: tenantID,  // è‡ªåŠ¨è®¾ç½®
        },
        Title:       req.Title,
        Description: req.Description,
        // ... å…¶ä»–å­—æ®µ
    }
    
    err = s.db.Create(job).Error
    return job, err
}

// Update æ›´æ–°ï¼ˆè‡ªåŠ¨æ ¡éªŒtenant_idï¼‰
func (s *JobService) Update(ctx context.Context, id int64, req *JobUpdateRequest) error {
    // 1. ä»contextè·å–ç§Ÿæˆ·ID
    tenantID, err := context.GetTenantID(ctx)
    if err != nil {
        return err
    }
    
    // 2. æ›´æ–°æ—¶æ ¡éªŒtenant_id
    var job Job
    err = s.db.Where("id = ? AND tenant_id = ?", id, tenantID).First(&job).Error
    if err != nil {
        return err
    }
    
    // 3. æ›´æ–°æ•°æ®
    updates := map[string]interface{}{
        "title":       req.Title,
        "description": req.Description,
        // ... å…¶ä»–å­—æ®µ
    }
    
    err = s.db.Model(&job).Updates(updates).Error
    return err
}

// Delete åˆ é™¤ï¼ˆè‡ªåŠ¨æ ¡éªŒtenant_idï¼‰
func (s *JobService) Delete(ctx context.Context, id int64) error {
    tenantID, err := context.GetTenantID(ctx)
    if err != nil {
        return err
    }
    
    // è½¯åˆ é™¤ï¼Œè‡ªåŠ¨æ ¡éªŒtenant_id
    err = s.db.Where("id = ? AND tenant_id = ?", id, tenantID).
        Delete(&Job{}).Error
    return err
}
```

---

### Step 5: ç§Ÿæˆ·ç®¡ç†API

#### 5.1 ç§Ÿæˆ·Service

**æ–‡ä»¶**: `services/core/tenant/service.go`

```go
package tenant

import (
    "context"
    "errors"
    "github.com/szjason72/zervigo/shared/core/context"
    "gorm.io/gorm"
)

type TenantService struct {
    db *gorm.DB
}

// Create åˆ›å»ºç§Ÿæˆ·
func (s *TenantService) Create(ctx context.Context, req *TenantCreateRequest) (*Tenant, error) {
    // 1. æ£€æŸ¥ç§Ÿæˆ·ä»£ç æ˜¯å¦å·²å­˜åœ¨
    var existing Tenant
    err := s.db.Where("code = ?", req.Code).First(&existing).Error
    if err == nil {
        return nil, errors.New("tenant code already exists")
    }
    
    // 2. åˆ›å»ºç§Ÿæˆ·
    tenant := &Tenant{
        Name:        req.Name,
        Code:        req.Code,
        Description: req.Description,
        Status:      "active",
    }
    
    err = s.db.Create(tenant).Error
    if err != nil {
        return nil, err
    }
    
    // 3. åˆ›å»ºç”¨æˆ·-ç§Ÿæˆ·å…³è”ï¼ˆåˆ›å»ºè€…ä¸ºownerï¼‰
    userID := getUserIDFromContext(ctx)
    userTenant := &UserTenant{
        UserID:   userID,
        TenantID: tenant.ID,
        Role:     "owner",
        Status:   "active",
    }
    err = s.db.Create(userTenant).Error
    
    return tenant, err
}

// List ç§Ÿæˆ·åˆ—è¡¨ï¼ˆå½“å‰ç”¨æˆ·çš„ç§Ÿæˆ·ï¼‰
func (s *TenantService) List(ctx context.Context) ([]*Tenant, error) {
    userID := getUserIDFromContext(ctx)
    
    var tenants []*Tenant
    err := s.db.Table("zervigo_tenants").
        Joins("JOIN zervigo_user_tenants ON zervigo_tenants.id = zervigo_user_tenants.tenant_id").
        Where("zervigo_user_tenants.user_id = ?", userID).
        Where("zervigo_user_tenants.status = ?", "active").
        Find(&tenants).Error
    
    return tenants, err
}

// Switch åˆ‡æ¢ç§Ÿæˆ·
func (s *TenantService) Switch(ctx context.Context, tenantID int64) error {
    userID := getUserIDFromContext(ctx)
    
    // 1. éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰è¯¥ç§Ÿæˆ·çš„æƒé™
    var userTenant UserTenant
    err := s.db.Where("user_id = ? AND tenant_id = ? AND status = ?", 
        userID, tenantID, "active").First(&userTenant).Error
    if err != nil {
        return errors.New("no permission for this tenant")
    }
    
    // 2. æ›´æ–°ç”¨æˆ·çš„last_tenant_idï¼ˆåœ¨ç”¨æˆ·è¡¨ä¸­ï¼‰
    err = s.db.Model(&User{}).
        Where("id = ?", userID).
        Update("last_tenant_id", tenantID).Error
    
    return err
}
```

#### 5.2 ç§Ÿæˆ·Controller

**æ–‡ä»¶**: `services/core/tenant/controller.go`

```go
package tenant

import (
    "github.com/gin-gonic/gin"
    "github.com/szjason72/zervigo/shared/core/response"
    "strconv"
)

type TenantController struct {
    service *TenantService
}

// Create åˆ›å»ºç§Ÿæˆ·
// POST /api/v1/tenants
func (c *TenantController) Create(ctx *gin.Context) {
    var req TenantCreateRequest
    if err := ctx.ShouldBindJSON(&req); err != nil {
        response.Error(ctx, 400, "Invalid request", nil)
        return
    }
    
    tenant, err := c.service.Create(ctx.Request.Context(), &req)
    if err != nil {
        response.Error(ctx, 500, err.Error(), nil)
        return
    }
    
    response.Success(ctx, tenant)
}

// List ç§Ÿæˆ·åˆ—è¡¨
// GET /api/v1/tenants
func (c *TenantController) List(ctx *gin.Context) {
    tenants, err := c.service.List(ctx.Request.Context())
    if err != nil {
        response.Error(ctx, 500, err.Error(), nil)
        return
    }
    
    response.Success(ctx, tenants)
}

// Switch åˆ‡æ¢ç§Ÿæˆ·
// POST /api/v1/tenants/:id/switch
func (c *TenantController) Switch(ctx *gin.Context) {
    tenantID, err := strconv.ParseInt(ctx.Param("id"), 10, 64)
    if err != nil {
        response.Error(ctx, 400, "Invalid tenant ID", nil)
        return
    }
    
    err = c.service.Switch(ctx.Request.Context(), tenantID)
    if err != nil {
        response.Error(ctx, 500, err.Error(), nil)
        return
    }
    
    response.Success(ctx, gin.H{"message": "Tenant switched successfully"})
}
```

---

### Step 6: JWT Tokenæ›´æ–°

#### 6.1 æ›´æ–°JWT Claims

**æ–‡ä»¶**: `shared/core/auth/types.go`

```go
package auth

// Claims JWT Claimsï¼ˆåŒ…å«tenant_idï¼‰
type Claims struct {
    UserID   int64  `json:"user_id"`
    Username string `json:"username"`
    TenantID int64  `json:"tenant_id"`  // æ–°å¢ç§Ÿæˆ·ID
    Role     string `json:"role"`
    jwt.StandardClaims
}
```

#### 6.2 æ›´æ–°Tokenç”Ÿæˆ

**æ–‡ä»¶**: `shared/core/auth/auth.go`

```go
func (a *AuthSystem) GenerateToken(userID int64, username string, tenantID int64) (string, error) {
    claims := Claims{
        UserID:   userID,
        Username: username,
        TenantID: tenantID,  // åŒ…å«ç§Ÿæˆ·ID
        Role:     "user",
        StandardClaims: jwt.StandardClaims{
            ExpiresAt: time.Now().Add(15 * time.Minute).Unix(),
        },
    }
    
    token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
    return token.SignedString([]byte(a.jwtSecret))
}
```

---

### Step 7: å‰ç«¯é›†æˆ

#### 7.1 ç§Ÿæˆ·åˆ‡æ¢ç»„ä»¶

**æ–‡ä»¶**: `frontend/src/components/TenantSwitcher.vue`

```vue
<template>
  <el-dropdown @command="handleSwitch">
    <span class="tenant-switcher">
      {{ currentTenant?.name }}
      <el-icon><ArrowDown /></el-icon>
    </span>
    <template #dropdown>
      <el-dropdown-menu>
        <el-dropdown-item 
          v-for="tenant in tenantList" 
          :key="tenant.id"
          :command="tenant.id"
          :disabled="tenant.id === currentTenant?.id"
        >
          {{ tenant.name }}
        </el-dropdown-item>
      </el-dropdown-menu>
    </template>
  </el-dropdown>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { getTenantList, switchTenant } from '@/api/tenant'
import { useUserStore } from '@/stores/user'

const userStore = useUserStore()
const tenantList = ref([])
const currentTenant = ref(null)

onMounted(async () => {
  await loadTenants()
  currentTenant.value = userStore.currentTenant
})

const loadTenants = async () => {
  const res = await getTenantList()
  tenantList.value = res.data
}

const handleSwitch = async (tenantId: number) => {
  await switchTenant(tenantId)
  // åˆ·æ–°é¡µé¢æˆ–é‡æ–°åŠ è½½æ•°æ®
  window.location.reload()
}
</script>
```

#### 7.2 ç§Ÿæˆ·API

**æ–‡ä»¶**: `frontend/src/api/tenant.ts`

```typescript
import request from './request'

export interface Tenant {
  id: number
  name: string
  code: string
  description?: string
  status: string
}

export const getTenantList = () => {
  return request.get<Tenant[]>('/api/v1/tenants')
}

export const createTenant = (data: Partial<Tenant>) => {
  return request.post<Tenant>('/api/v1/tenants', data)
}

export const switchTenant = (tenantId: number) => {
  return request.post(`/api/v1/tenants/${tenantId}/switch`)
}
```

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: `services/core/tenant/service_test.go`

```go
func TestTenantService_Create(t *testing.T) {
    // æµ‹è¯•ç§Ÿæˆ·åˆ›å»º
}

func TestTenantService_List(t *testing.T) {
    // æµ‹è¯•ç§Ÿæˆ·åˆ—è¡¨
}

func TestTenantService_Switch(t *testing.T) {
    // æµ‹è¯•ç§Ÿæˆ·åˆ‡æ¢
}
```

### é›†æˆæµ‹è¯•

**æ–‡ä»¶**: `tests/integration/tenant_test.go`

```go
func TestTenantDataIsolation(t *testing.T) {
    // æµ‹è¯•ç§Ÿæˆ·æ•°æ®éš”ç¦»
    // 1. åˆ›å»ºä¸¤ä¸ªç§Ÿæˆ·
    // 2. ç§Ÿæˆ·Aåˆ›å»ºæ•°æ®
    // 3. ç§Ÿæˆ·BæŸ¥è¯¢æ•°æ®ï¼ˆåº”è¯¥æŸ¥ä¸åˆ°ç§Ÿæˆ·Açš„æ•°æ®ï¼‰
}
```

---

## ğŸ“Š å®æ–½æ£€æŸ¥æ¸…å•

### Phase 1: å¤šç§Ÿæˆ·æ ¸å¿ƒåŠŸèƒ½ âœ…/âŒ

**åŸºç¡€è®¾æ–½**
- [ ] TenantContextå®ç°
- [ ] TenantMiddlewareå®ç°
- [ ] JWT TokenåŒ…å«tenant_id
- [ ] å•å…ƒæµ‹è¯•

**æ•°æ®åº“**
- [ ] ç§Ÿæˆ·è¡¨åˆ›å»º
- [ ] ç”¨æˆ·-ç§Ÿæˆ·å…³è”è¡¨åˆ›å»º
- [ ] æ‰€æœ‰ä¸šåŠ¡è¡¨æ·»åŠ tenant_id
- [ ] ç´¢å¼•åˆ›å»º
- [ ] æ•°æ®è¿ç§»è„šæœ¬

**åŸºç¡€æ¨¡å‹**
- [ ] BaseModelæ›´æ–°
- [ ] æ‰€æœ‰é¢†åŸŸæ¨¡å‹æ›´æ–°
- [ ] GORM Scopeå®ç°

### Phase 2: ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½ âœ…/âŒ

**API**
- [ ] ç§Ÿæˆ·åˆ›å»ºAPI
- [ ] ç§Ÿæˆ·åˆ—è¡¨API
- [ ] ç§Ÿæˆ·è¯¦æƒ…API
- [ ] ç§Ÿæˆ·æ›´æ–°API
- [ ] ç§Ÿæˆ·åˆ é™¤API
- [ ] ç§Ÿæˆ·åˆ‡æ¢API

**ç”¨æˆ·å…³è”**
- [ ] ç”¨æˆ·åŠ å…¥ç§Ÿæˆ·API
- [ ] ç”¨æˆ·ç¦»å¼€ç§Ÿæˆ·API
- [ ] ç”¨æˆ·ç§Ÿæˆ·åˆ—è¡¨API

### Phase 3: æ•°æ®éš”ç¦»å®Œå–„ âœ…/âŒ

**Serviceå±‚**
- [ ] æ‰€æœ‰Serviceæ–¹æ³•æ›´æ–°
- [ ] æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤
- [ ] åˆ›å»ºè‡ªåŠ¨è®¾ç½®tenant_id
- [ ] æ›´æ–°è‡ªåŠ¨æ ¡éªŒtenant_id

**Mapper/DAOå±‚**
- [ ] æ‰€æœ‰æŸ¥è¯¢SQLæ›´æ–°
- [ ] æ‰€æœ‰æ’å…¥SQLæ›´æ–°
- [ ] æ‰€æœ‰æ›´æ–°SQLæ›´æ–°

### Phase 4: æƒé™éš”ç¦»å®Œå–„ âœ…/âŒ

**æƒé™æ¨¡å‹**
- [ ] è§’è‰²è¡¨æ·»åŠ tenant_id
- [ ] æƒé™è¡¨æ·»åŠ tenant_id
- [ ] ç”¨æˆ·è§’è‰²å…³è”è¡¨æ·»åŠ tenant_id

**æƒé™æ£€æŸ¥**
- [ ] æƒé™æ£€æŸ¥æ›´æ–°
- [ ] è§’è‰²æŸ¥è¯¢æ›´æ–°
- [ ] æƒé™åˆ†é…æ›´æ–°

### Phase 5: å‰ç«¯é›†æˆ âœ…/âŒ

**é¡µé¢**
- [ ] ç§Ÿæˆ·åˆ—è¡¨é¡µé¢
- [ ] ç§Ÿæˆ·åˆ›å»º/ç¼–è¾‘é¡µé¢
- [ ] ç§Ÿæˆ·è¯¦æƒ…é¡µé¢

**ç»„ä»¶**
- [ ] ç§Ÿæˆ·åˆ‡æ¢ç»„ä»¶
- [ ] ç§Ÿæˆ·é€‰æ‹©ç»„ä»¶

### Phase 6: æµ‹è¯•éªŒè¯ âœ…/âŒ

**æµ‹è¯•**
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ•°æ®éš”ç¦»æµ‹è¯•
- [ ] æƒé™éš”ç¦»æµ‹è¯•
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡

```bash
# 1. ç¡®è®¤Goç‰ˆæœ¬
go version  # éœ€è¦ 1.21+

# 2. ç¡®è®¤PostgreSQLç‰ˆæœ¬
psql --version  # éœ€è¦ 15+

# 3. ç¡®è®¤Redisç‰ˆæœ¬
redis-cli --version  # éœ€è¦ 7+
```

### ç¬¬äºŒæ­¥ï¼šæ•°æ®åº“è¿ç§»

```bash
cd /Users/szjason72/gozervi/zervigo.demo

# 1. æ‰§è¡Œç§Ÿæˆ·è¡¨åˆ›å»º
psql -U postgres -d zervigo_mvp -f databases/postgres/init/03-tenant-tables.sql

# 2. æ‰§è¡Œä¸ºç°æœ‰è¡¨æ·»åŠ tenant_id
psql -U postgres -d zervigo_mvp -f databases/postgres/migrations/add_tenant_id.sql
```

### ç¬¬ä¸‰æ­¥ï¼šä»£ç å®ç°

```bash
# 1. åˆ›å»ºTenantContext
# æ–‡ä»¶: shared/core/context/tenant_context.go

# 2. åˆ›å»ºTenantMiddleware
# æ–‡ä»¶: shared/core/middleware/tenant_middleware.go

# 3. æ›´æ–°BaseModel
# æ–‡ä»¶: shared/core/model/base_model.go
```

### ç¬¬å››æ­¥ï¼šæµ‹è¯•éªŒè¯

```bash
# 1. è¿è¡Œå•å…ƒæµ‹è¯•
go test ./services/core/tenant/...

# 2. è¿è¡Œé›†æˆæµ‹è¯•
go test ./tests/integration/...

# 3. å¯åŠ¨æœåŠ¡æµ‹è¯•
./scripts/start-local-services.sh
```

---

## ğŸ“ˆ é‡Œç¨‹ç¢‘

### Milestone 1: å¤šç§Ÿæˆ·æ ¸å¿ƒåŠŸèƒ½ï¼ˆWeek 2ç»“æŸï¼‰
- âœ… TenantContextå®ç°
- âœ… æ•°æ®åº“è¿ç§»å®Œæˆ
- âœ… åŸºç¡€æ¨¡å‹æ›´æ–°å®Œæˆ

### Milestone 2: ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½ï¼ˆWeek 2ç»“æŸï¼‰
- âœ… ç§Ÿæˆ·CRUD APIå®Œæˆ
- âœ… ç”¨æˆ·-ç§Ÿæˆ·å…³è”å®Œæˆ
- âœ… ç§Ÿæˆ·åˆ‡æ¢åŠŸèƒ½å®Œæˆ

### Milestone 3: æ•°æ®éš”ç¦»å®Œå–„ï¼ˆWeek 3ç»“æŸï¼‰
- âœ… æ‰€æœ‰Serviceå±‚æ›´æ–°å®Œæˆ
- âœ… æ‰€æœ‰æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤
- âœ… æ•°æ®éš”ç¦»æµ‹è¯•é€šè¿‡

### Milestone 4: æƒé™éš”ç¦»å®Œå–„ï¼ˆWeek 4ç»“æŸï¼‰
- âœ… ç§Ÿæˆ·çº§åˆ«æƒé™å®ç°
- âœ… æƒé™éš”ç¦»æµ‹è¯•é€šè¿‡

### Milestone 5: å‰ç«¯é›†æˆï¼ˆWeek 5ç»“æŸï¼‰
- âœ… ç§Ÿæˆ·ç®¡ç†é¡µé¢å®Œæˆ
- âœ… ç§Ÿæˆ·åˆ‡æ¢åŠŸèƒ½å®Œæˆ

### Milestone 6: ç³»ç»Ÿå®Œå–„ï¼ˆWeek 6ç»“æŸï¼‰
- âœ… ç›‘æ§ç³»ç»Ÿé›†æˆ
- âœ… APIæ–‡æ¡£å®Œæˆ
- âœ… æ€§èƒ½ä¼˜åŒ–å®Œæˆ

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… æ‰€æœ‰ä¸šåŠ¡è¡¨åŒ…å«tenant_idå­—æ®µ
- âœ… æ‰€æœ‰æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤tenant_id
- âœ… æ”¯æŒç§Ÿæˆ·åˆ›å»ºã€åˆ‡æ¢ã€ç®¡ç†
- âœ… ç§Ÿæˆ·çº§åˆ«çš„æƒé™éš”ç¦»

### ä»£ç è´¨é‡
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- âœ… é›†æˆæµ‹è¯•é€šè¿‡ç‡ 100%
- âœ… ä»£ç å®¡æŸ¥é€šè¿‡

### æ€§èƒ½æŒ‡æ ‡
- âœ… æŸ¥è¯¢æ€§èƒ½ä¸ä¸‹é™ï¼ˆç´¢å¼•ä¼˜åŒ–ï¼‰
- âœ… å“åº”æ—¶é—´ < 200msï¼ˆP95ï¼‰
- âœ… å¹¶å‘æ”¯æŒ > 1000 QPS

### æ–‡æ¡£å®Œæ•´æ€§
- âœ… APIæ–‡æ¡£å®Œæ•´
- âœ… éƒ¨ç½²æ–‡æ¡£å®Œæ•´
- âœ… ç”¨æˆ·æ‰‹å†Œå®Œæ•´

---

## ğŸ“ é£é™©ä¸åº”å¯¹

### é£é™©1: æ•°æ®è¿ç§»é£é™©

**é£é™©**: ç°æœ‰æ•°æ®è¿ç§»å¯èƒ½ä¸¢å¤±æˆ–é”™è¯¯

**åº”å¯¹**:
- âœ… æ•°æ®è¿ç§»å‰å®Œæ•´å¤‡ä»½
- âœ… åˆ†æ‰¹æ¬¡è¿ç§»
- âœ… è¿ç§»åæ•°æ®æ ¡éªŒ
- âœ… å›æ»šæ–¹æ¡ˆå‡†å¤‡

### é£é™©2: æ€§èƒ½ä¸‹é™é£é™©

**é£é™©**: æ·»åŠ tenant_idè¿‡æ»¤å¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½

**åº”å¯¹**:
- âœ… åˆ›å»ºåˆé€‚çš„ç´¢å¼•
- âœ… æŸ¥è¯¢ä¼˜åŒ–
- âœ… æ€§èƒ½æµ‹è¯•
- âœ… ç¼“å­˜ç­–ç•¥

### é£é™©3: å…¼å®¹æ€§é£é™©

**é£é™©**: ç°æœ‰APIå¯èƒ½ä¸å…¼å®¹

**åº”å¯¹**:
- âœ… APIç‰ˆæœ¬æ§åˆ¶
- âœ… å‘åå…¼å®¹
- âœ… æ¸è¿›å¼è¿ç§»
- âœ… å……åˆ†æµ‹è¯•

---

## ğŸ“š å‚è€ƒèµ„æº

### ä»£ç å‚è€ƒ
- **CordysCRM**: `/Users/szjason72/Saasbolent/szbolent/CordysCRM-main`
  - OrganizationContextå®ç°
  - Webè¿‡æ»¤å™¨å®ç°
  - æ•°æ®åº“è®¾è®¡

### æ–‡æ¡£å‚è€ƒ
- **SaaSè§„åˆ’æ–‡æ¡£**: `SAAS_SYSTEM_PLANNING.md`
- **GoZerviè¯„ä¼°**: `GOZERVI_SAAS_EVALUATION.md`
- **CordysCRMåˆ†æ**: `CORDYSCRM_MULTI_TENANT_ANALYSIS.md`

---

## ğŸ‰ æ€»ç»“

æœ¬å®æ–½æ–¹æ¡ˆåŸºäºä»¥ä¸‹åˆ†æï¼š
1. âœ… **GoZerviç°çŠ¶**: 88%å®Œæˆï¼Œç¼ºå°‘å¤šç§Ÿæˆ·æ”¯æŒ
2. âœ… **CordysCRMç»éªŒ**: å®Œæ•´çš„å¤šç§Ÿæˆ·å®ç°ï¼Œå¯ç›´æ¥å€Ÿé‰´
3. âœ… **åˆ†é˜¶æ®µå®æ–½**: 6å‘¨å®Œæˆï¼Œåˆ†5ä¸ªé˜¶æ®µ
4. âœ… **å¯æ‰§è¡Œæ€§**: è¯¦ç»†çš„ä»£ç ç¤ºä¾‹å’Œå®æ–½æ­¥éª¤

**ä¸‹ä¸€æ­¥**: æŒ‰ç…§æœ¬æ–¹æ¡ˆå¼€å§‹å®æ–½ï¼Œä¼˜å…ˆå®ŒæˆPhase 1ï¼ˆå¤šç§Ÿæˆ·æ ¸å¿ƒåŠŸèƒ½ï¼‰ã€‚

---

**æ–¹æ¡ˆç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-01-XX  
**é¢„è®¡å®Œæˆæ—¶é—´**: 6å‘¨  
**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ

